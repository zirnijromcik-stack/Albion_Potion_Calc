<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É - Albion Online</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* –î–∏–Ω–∞–º—ñ—á–Ω—ñ –∫–æ–ª—å–æ—Ä–∏ –∑ —Ç–µ–º–∏ */
        :root {
            --primary-color: {{ theme.primary_color }};
            --secondary-color: {{ theme.secondary_color }};
            --danger-color: {{ theme.danger_color }};
            --warning-color: {{ theme.warning_color }};
            --bg-gradient-start: {{ theme.background_gradient_start }};
            --bg-gradient-end: {{ theme.background_gradient_end }};
            --card-bg: {{ theme.card_background }};
            --text-color: {{ theme.text_color }};
            --border-color: {{ theme.border_color }};
        }
        
        body {
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É</h1>
            <a href="/" class="btn-back">‚Üê –ù–∞–∑–∞–¥ –¥–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞</a>
        </header>

        <div class="result-card">
            <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                {% if result.potion_image %}
                <img src="{{ url_for('static', filename=result.potion_image) }}" alt="{{ result.potion_name }}" class="potion-icon-large">
                {% endif %}
                <h2>{{ result.potion_name }}</h2>
            </div>
            
            <div class="result-grid">
                <div class="result-section">
                    <h3>üì¶ –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∫—Ä–∞—Ñ—Ç—É</h3>
                    <div class="info-item">
                        <span class="label">–ó–∞–ø–∏—Ç–∞–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å:</span>
                        <span class="value">{{ result.quantity }} –∑—ñ–ª–ª—è</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–í–∏—Ö—ñ–¥ –∑ –æ–¥–Ω–æ–≥–æ –∫—Ä–∞—Ñ—Ç—É:</span>
                        <span class="value">{{ result.potion_yield }} –∑—ñ–ª–ª—è</span>
                    </div>
                    {% if result.effective_yield and result.effective_yield > result.potion_yield %}
                    <div class="info-item highlight">
                        <span class="label">–ï—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π –≤–∏—Ö—ñ–¥ (–∑ –±–æ–Ω—É—Å–æ–º):</span>
                        <span class="value">{{ "%.1f"|format(result.effective_yield) }} –∑—ñ–ª–ª—è</span>
                    </div>
                    {% endif %}
                    <div class="info-item">
                        <span class="label">–ü–æ—Ç—Ä—ñ–±–Ω–æ –∫—Ä–∞—Ñ—Ç—ñ–≤:</span>
                        <span class="value">{{ result.crafts_needed }}</span>
                    </div>
                    {% if result.actual_quantity > result.quantity %}
                    <div class="info-item warning">
                        <span class="label">–§–∞–∫—Ç–∏—á–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å:</span>
                        <span class="value">{{ result.actual_quantity }} –∑—ñ–ª–ª—è (–±—É–¥–µ –∑–∞–π–≤–µ)</span>
                    </div>
                    {% endif %}
                </div>

                <div class="result-section">
                    <h3>üí∞ –í–∞—Ä—Ç—ñ—Å—Ç—å –∫—Ä–∞—Ñ—Ç—É</h3>
                    <div class="info-item">
                        <span class="label">–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:</span>
                        <span class="value">{{ result.ingredient_cost|format_number }} —Å—Ä—ñ–±–ª–∞</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–°—Ç–∞–Ω–æ–∫:</span>
                        <span class="value">{{ result.machine_cost|format_number }} —Å—Ä—ñ–±–ª–∞</span>
                    </div>
                    <div class="info-item total">
                        <span class="label">–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å:</span>
                        <span class="value">{{ result.total_cost|format_number }} —Å—Ä—ñ–±–ª–∞</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–í–∞—Ä—Ç—ñ—Å—Ç—å –æ–¥–Ω–æ–≥–æ –∑—ñ–ª–ª—è:</span>
                        <span class="value">{{ result.cost_per_potion|format_number }} —Å—Ä—ñ–±–ª–∞</span>
                    </div>
                </div>

                <div class="result-section">
                    <h3>üíµ –ü—Ä–æ–¥–∞–∂ —Ç–∞ –ø—Ä–∏–±—É—Ç–æ–∫</h3>
                    <div class="info-item">
                        <span class="label">–¶—ñ–Ω–∞ –ø—Ä–æ–¥–∞–∂—É:</span>
                        <span class="value">{{ result.sell_price|format_number }} —Å—Ä—ñ–±–ª–∞</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–ü—ñ—Å–ª—è –ø–æ–¥–∞—Ç–∫—É —Ç–∞ –ª—ñ—Å—Ç–∏–Ω–≥—É:</span>
                        <span class="value">{{ result.sell_price_after_tax|format_number }} —Å—Ä—ñ–±–ª–∞</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–í–∏—Ç—Ä–∞—Ç–∏ —Å—Ç–∞–Ω–∫–∞:</span>
                        <span class="value">{{ result.machine_cost|format_number }} —Å—Ä—ñ–±–ª–∞</span>
                    </div>
                    <div class="info-item {% if result.profit_per_potion > 0 %}profit{% else %}loss{% endif %}">
                        <span class="label">–ü—Ä–∏–±—É—Ç–æ–∫ –∑ –æ–¥–Ω–æ–≥–æ –∑—ñ–ª–ª—è:</span>
                        <span class="value">{{ result.profit_per_potion|format_number }} —Å—Ä—ñ–±–ª–∞</span>
                    </div>
                    <div class="info-item {% if result.total_profit > 0 %}profit{% else %}loss{% endif %}">
                        <span class="label">–ó–∞–≥–∞–ª—å–Ω–∏–π –ø—Ä–∏–±—É—Ç–æ–∫:</span>
                        <span class="value">{{ result.total_profit|format_number }} —Å—Ä—ñ–±–ª–∞</span>
                    </div>
                    <div class="info-item">
                        <span class="label">ROI:</span>
                        <span class="value {% if result.roi_percent > 0 %}profit{% else %}loss{% endif %}">{{ "%.2f"|format(result.roi_percent) }}%</span>
                    </div>
                </div>
            </div>

            <div class="ingredients-section">
                <h3>üß™ –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–ª—è –∑–∞–∫—É–ø—ñ–≤–ª—ñ (–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è)</h3>
                <table class="ingredients-table">
                    <thead>
                        <tr>
                            <th>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç</th>
                            <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
                            <th>–¶—ñ–Ω–∞ –∑–∞ –æ–¥–∏–Ω–∏—Ü—é</th>
                            <th>–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ing_id, details in result.ingredient_details.items() %}
                        {% set per_craft_qty = details.quantity %}
                            {% set total_qty = details.required_total_quantity %}
                            {% set total_cost = details.required_total_cost %}
                        <tr>
                            <td>
                                <div class="ingredient-row">
                                    {% if details.image %}
                                    <img src="{{ url_for('static', filename=details.image) }}"
                                         alt="{{ details.get('name', ing_id) }}"
                                         class="ingredient-icon-small"
                                         onerror="this.style.display='none'">
                                    {% endif %}
                                    <span>{{ details.get('name', ing_id) }}</span>
                                </div>
                            </td>
                            <td>{{ total_qty|round(0, 'ceil')|int }}</td>
                            <td>{{ details.unit_price|format_number }} —Å—Ä—ñ–±–ª–∞</td>
                            <td>{{ total_cost|format_number }} —Å—Ä—ñ–±–ª–∞</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <div class="details-toggle">
                    <button type="button" class="btn-secondary" id="per-craft-toggle" onclick="togglePerCraftDetails()">
                        –ü–æ–∫–∞–∑–∞—Ç–∏ –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—é —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –Ω–∞ 1 –∫—Ä–∞—Ñ—Ç
                    </button>
                </div>

                <div id="per-craft-details" class="details-panel" style="display: none;">
                    <h3>üß™ –î–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ (–Ω–∞ 1 –∫—Ä–∞—Ñ—Ç)</h3>
                    <table class="ingredients-table fullwidth">
                        <thead>
                            <tr>
                                <th>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç</th>
                                <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å (1 –∫—Ä–∞—Ñ—Ç)</th>
                                <th>–¶—ñ–Ω–∞ –∑–∞ –æ–¥–∏–Ω–∏—Ü—é</th>
                                <th>–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ing_id, details in result.ingredient_details.items() %}
                            <tr>
                                <td>
                                    <div class="ingredient-row">
                                        {% if details.image %}
                                        <img src="{{ url_for('static', filename=details.image) }}"
                                             alt="{{ details.get('name', ing_id) }}"
                                             class="ingredient-icon-small"
                                             onerror="this.style.display='none'">
                                        {% endif %}
                                        <span>{{ details.get('name', ing_id) }}</span>
                                    </div>
                                </td>
                                <td>{{ details.quantity|round(0, 'ceil')|int }}</td>
                                <td>{{ details.unit_price|format_number }} —Å—Ä—ñ–±–ª–∞</td>
                                <td>{{ details.total_cost|format_number }} —Å—Ä—ñ–±–ª–∞</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="settings-section">
                <h3>‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h3>
                <div class="settings-grid">
                    <div class="setting-item">
                        <span class="setting-label">–ú—ñ—Å—Ç–æ –∫—Ä–∞—Ñ—Ç—É:</span>
                        <span class="setting-value">{{ result.settings.craft_city }}</span>
                        {% if result.settings.brecilien_bonus > 0 %}
                        <span class="bonus-badge">+{{ "%.0f"|format(result.settings.brecilien_bonus * 100) }}% –±–æ–Ω—É—Å</span>
                        {% endif %}
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">–ú—ñ—Å—Ç–æ –ø—Ä–æ–¥–∞–∂—É:</span>
                        <span class="setting-value">{{ result.settings.sell_city }}</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">–í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ñ–æ–∫—É—Å:</span>
                        <span class="setting-value">{{ "–¢–∞–∫" if result.settings.focus_bonus else "–ù—ñ" }}</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">–î–æ–¥–∞—Ç–∫–æ–≤–∏–π –±–æ–Ω—É—Å:</span>
                        <span class="setting-value">{{ "%.1f"|format(result.settings.extra_bonus_pct) }}%</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">–ù–∞—è–≤–Ω—ñ—Å—Ç—å –ø—Ä–µ–º—ñ—É–º—É:</span>
                        <span class="setting-value">{{ "–¢–∞–∫" if result.settings.premium else "–ù—ñ" }}</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤:</span>
                        <span class="setting-value">{{ "%.1f"|format(result.settings.return_rate * 100) }}%</span>
                        {% if result.get('is_custom_return_rate') %}
                        <span style="font-size: 0.85em; color: #7f8c8d;">(–∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π)</span>
                        {% else %}
                        <span style="font-size: 0.85em; color: #7f8c8d;">(—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π)</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="position: fixed; bottom: 2px; left: 12px; font-size: 12px; color: #ecf0f1; opacity: 0.9; z-index: 9999; pointer-events: none; text-shadow: 0 0 4px rgba(0,0,0,0.35);">
        –†–æ–∑—Ä–æ–±–∏–≤ F2000
    </div>

    <script>
    function togglePerCraftDetails() {
        const panel = document.getElementById('per-craft-details');
        const btn = document.getElementById('per-craft-toggle');
        const isHidden = panel.style.display === 'none' || panel.style.display === '';
        if (isHidden) {
            panel.style.display = 'block';
            if (btn) btn.textContent = '–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—é —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –Ω–∞ 1 –∫—Ä–∞—Ñ—Ç';
        } else {
            panel.style.display = 'none';
            if (btn) btn.textContent = '–ü–æ–∫–∞–∑–∞—Ç–∏ –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—é —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –Ω–∞ 1 –∫—Ä–∞—Ñ—Ç';
        }
    }
    document.addEventListener('DOMContentLoaded', () => {
        const panel = document.getElementById('per-craft-details');
        const btn = document.getElementById('per-craft-toggle');
        if (panel && btn) {
            panel.style.display = 'none';
            btn.textContent = '–ü–æ–∫–∞–∑–∞—Ç–∏ –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—é —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –Ω–∞ 1 –∫—Ä–∞—Ñ—Ç';
        }
    });
    </script>
</body>
</html>
